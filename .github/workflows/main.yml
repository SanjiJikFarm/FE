name: git push into another repo to deploy to vercel

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 레포 체크아웃 (히스토리 전체 필요 → fetch-depth: 0)
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. 빌드 도구 설치 (pandoc, texlive, git, ruby, mustache)
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-latex-base texlive-xetex texlive-fonts-recommended
          sudo apt-get install -y ruby-full git
          gem install mustache

      # 3. 빌드 실행
      - name: creates output
        run: sh ./build.sh

      # 4. output 폴더를 다른 repo에 push (히스토리 유지)
      - name: Push output folder to another repo with history
        run: |
          git config --global user.email "${{ secrets.ONLY1KSY_ACCOUNT_EMAIL }}"
          git config --global user.name "only1Ksy"
          git remote add deploy https://x-access-token:${{ secrets.ONLY1KSY_GITHUB_KEY }}@github.com/only1Ksy/Sanjijikfarm-Frontend.git
          git push deploy `git subtree split --prefix output main`:main --force
